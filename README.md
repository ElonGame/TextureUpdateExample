TextureUpdateExample
====================

![gif](https://i.imgur.com/VqHhCcx.gif)

*Old-school plasma effect generated by C++ code*

This is an example that shows how to use the [CustomTextureUpdate] callback
that allows native plugins to update contents of textures in a thread-safe and
platform agnostic way.

[CustomTextureUpdate]: https://docs.unity3d.com/ScriptReference/Rendering.CommandBuffer.IssuePluginCustomTextureUpdate.html

How to implement the CustomTextureUpdate callback
-------------------------------------------------

Signature for the callback function should be like the following function:

```
void TextureUpdateCallback(int eventID, void* data)
```

The type of the event is given via `eventID`, and `data` carries some
parameters about the target texture via `UnityRenderingExtTextureUpdateParams` 
struct (you have to typecast to `UnityRenderingExtTextureUpdateParams*` before
using it).

The possible values of `eventID` are defined in `UnityRenderingExtEventType`,
and `kUnityRenderingExtEventUpdateTextureBegin` and
`kUnityRenderingExtEventUpdateTextureEnd` are relevant to texture update.

`kUnityRenderingExtEventUpdateTextureBegin` - The texture will be updated
right after returning from this callback. You can give the new content of the
texture by giving a image bitmap to `texData` in the parameter struct. Also
you can return `NULL` when you don't like to update the texture this time.

`kUnityRenderingExtEventUpdateTextureEnd` - The texture has been updated. You
can safely release the resources used to update the texture.

Also you have to implement the interface function that is used to retrieve
the pointer of the callback function.

```
extern "C" UnityRenderingEventAndData UNITY_INTERFACE_EXPORT
  GetTextureUpdateCallback()
{
    return TextureUpdateCallback;
}
```

For further details of the plugin implementation, please see the [example
source code](https://github.com/keijiro/TextureUpdateExample/blob/master/Plugin/Plasma.cpp)
included in this repository.

How to use the callback from C# scripts
---------------------------------------

In order to request texture update from C# scripts, you can use
`IssuePluginCustomTextureUpdate` with a `CommandBuffer`. The pointer to the
callback function and a texture to be updated should be given to the command.
You can also give a single `uint` value to the command that can be used to 
pass user data to the callback.

```
[DllImport("DllName")]
static extern System.IntPtr GetTextureUpdateCallback();

...

m_CommandBuffer.IssuePluginCustomTextureUpdate
    (GetTextureUpdateCallback(), texture, userData);
Graphics.ExecuteCommandBuffer(m_CommandBuffer);
```

Platform availability
---------------------

At the moment of Unity 2017.2, the CustomTextureUpdate callback is only
available with Direct3D 11, Metal and OpenGL ES. For other platforms
(Vulkan, consoles, etc.), you have to implement platform dependent plugins to
update textures.
